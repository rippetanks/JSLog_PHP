/*
  This Source Code Form is subject to the terms of the Mozilla Public
  License, v. 2.0. If a copy of the MPL was not distributed with this
  file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

const JSLog=function(){function a(o){return $.ajax({url:l.url_log,method:'POST',contentType:'application/json',data:JSON.stringify(o),success:function(p,q,r){l.enable_internal_log&&j.log('JSLog HTTP '+r.status+'!'),l.callback_success&&l.callback_success(p,q,r)},error:function(p,q,r){l.enable_internal_log&&j.error('JSLog HTTP '+p.status+'! '+r),l.callback_error&&l.callback_error(p,q,r)}})}function b(o){return o=jQuery.extend(o,m),$.ajax({url:l.url_profile,method:'POST',contentType:'application/json',data:JSON.stringify(o),success:function(p,q,r){l.enable_internal_log&&j.log('JSLog-Profile HTTP '+r.status+'!')},error:function(p,q,r){l.enable_internal_log&&j.error('JSLog-Profile HTTP '+p.status+'! '+r)}})}function c(){console={assert:function(o,...p){l.enable_internal_log||j.assert(o,p),o||JSLog.bulk(h.ASSERT,p)},debug:function(...o){return l.enable_internal_log||j.debug(o),JSLog.bulk(h.DEBUG,o)},error:function(...o){return l.enable_internal_log||j.error(o),JSLog.bulk(h.ERROR,o)},info:function(...o){return l.enable_internal_log||j.info(o),JSLog.bulk(h.INFO,o)},log:function(...o){return l.enable_internal_log||j.info(o),JSLog.bulk(h.INFO,o)},trace:function(...o){return l.enable_internal_log||j.trace(o),JSLog.bulk(h.TRACE,o)},warn:function(...o){return l.enable_internal_log||j.warn(o),JSLog.bulk(h.WARN,o)}}}function f(o){let p=o.filter(function(q){return q.level[1]>=l.level[1]});return m?(p.forEach(function(q){q.level=q.level[0],q=jQuery.extend(q,m),q.httpCode||delete q.httpCode}),a(p)):void j.warn('Call the init function first!')}function g(){let o={};return l.entity&&(o.entity=l.entity),l.log_key&&(o.log_key=l.log_key),o}const h={TRACE:['TRACE',0],DEBUG:['DEBUG',1],INFO:['INFO',2],WARN:['WARN',3],ERROR:['ERROR',4],ASSERT:['ASSERT',4],FATAL:['FATAL',5]},j=console;let k=[],l={url_log:null,url_profile:null,entity:null,level:h.TRACE,log_key:null,ajax:a,cache:null,console_override:!1,enable_internal_log:!1,enable_profile:!1,callback_success:null,callback_error:null},m;return{init:function(o){l=jQuery.extend(l,o),l.url_log||console.warn('Please, set a url_log!'),l.console_override&&this.override(),m=g()},log:function(o,p,q){if(!o||!p)return j.warn('Incomplete data!'),!1;if(1<=l.cache){if(k.push({level:o,message:p,httpCode:q,datetime:new Date().toISOString()}),k.length===l.cache){let r=Array.from(k);return k=[],f(r)}return!1}return f([{level:o,message:p,httpCode:q,datetime:new Date().toISOString()}])},bulk:function(o,...p){let q=[];for(let r=0;r<p.length;r++)q[r]=this.log(o,p[r]);return q},trace:function(o,p){return this.log(h.TRACE,o,p)},debug:function(o,p){return this.log(h.DEBUG,o,p)},info:function(o,p){return this.log(h.INFO,o,p)},warn:function(o,p){return this.log(h.WARN,o,p)},error:function(o,p){return this.log(h.ERROR,o,p)},fatal:function(o,p){return this.log(h.FATAL,o,p)},getLevel:function(){return l.level},getLevelString:function(){return l.level[0]},setLevel:function(o){l.level=o},override:function(){c()},nativeConsole:function(){return j},enableCache:function(o){l.cache=o},disableCache:function(){l.cache=null},cacheSize:function(){return k.length},flush:function(){return!!(0<k.length)&&f(k)},LOG_LEVEL:h,profile:function(o,p){if(!l.enable_profile)return-1;if(void 0==o)return new Date().getTime();let q=new Date().getTime();return b({time:q-o,desc:p})},disableProfile:function(){l.enable_profile=!1},enableProfile:function(){l.enable_profile=!0}}}();Object.freeze(JSLog.LOG_LEVEL),Object.freeze(JSLog);
